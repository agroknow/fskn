define(["js/core/coursera","backbone","jquery","underscore","pages/home/front/frontAutocompleteEntries.html","js/models/autocomplete"],function(t,e,i,o,s,a){var n=e.View.extend({events:{"mouseover li>ul>li":"_mouseover","click li>ul>li":"_click"},tagName:"ul",className:"coursera-front-autocomplete-menu",render:function(t,e){this.$el.empty(),this.$el.append(s({suggestions:t,searchString:e}))},move:function(t){var e=this.$("li>ul>li").index(this.$(".active"));this.$("li>ul>li").removeClass("active");var i=e+t;-1==i&&(i=this.$("li>ul>li").length-1),i==this.$("li>ul>li").length&&(i=0),i>=0&&this.$("li>ul>li").eq(i).addClass("active")},navigateActive:function(){var e=this.$("li>ul>li").index(this.$(".active")),i=this.$(".active");if(0===i.length)return!1;var o=i.find("a").attr("href");return this.trigger("navigateTo",o,e),t.router.navigate(o,{trigger:!0}),!0},_mouseover:function(t){this.$("li>ul>li").removeClass("active"),i(t.currentTarget).addClass("active")},_click:function(t){this.$("li>ul>li").removeClass("active"),i(t.currentTarget).addClass("active"),this.navigateActive()}}),r=e.View.extend({events:{keydown:"_keydown",focus:"_focus",blur:"_blur"},initialize:function(){var e=this;this.menu=new n,this.model=new a,this._searchDebounce=o.debounce(o.bind(this._search,this),20),this.lastSearch="",this._trackDebounce=o.debounce(o.bind(function(){t.tracker.push({key:"user.coursera.front.autocomplete.input",val:this.lastSearch})},this),400),this.menu.on("navigateTo",function(i,o){t.tracker.push({key:"user.coursera.front.autocomplete.navigate",val:i+"|"+e.$el.val()+"|"+o}),e._closeMenu()})},render:function(){this.$el.attr("autocomplete","off"),this.menu.$el.hide(),this.$el.after(this.menu.$el)},_closeMenu:function(){this.menu.$el.hide()},_suggest:function(t,e){this.menu.render(t,e),this.menu.$el.show()},_search:function(t){var e=this,i=this.$el.val();(i!=this.lastSearch||t)&&(this.lastSearch=i,this._trackDebounce(),i.length>0?this.model.search(i).done(function(t){e._suggest(t,i)}):this._closeMenu())},_keydown:function(t){switch(t.which){case 13:return!this.menu.navigateActive();case 27:this._searchDebounce(!0);break;case 38:return this.menu.move(-1),!1;case 40:return this.menu.move(1),!1;default:this._searchDebounce()}},_blur:function(){setTimeout(o.bind(this._closeMenu,this),400)},_focus:function(){this._searchDebounce(!0)}});return r});